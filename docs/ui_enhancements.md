# GUI改善ドキュメント (2024-12-28)

## 概要
ユーザーの操作性向上のため、GUIレイアウトおよび機能の改善を行いました。

**注**: 2024-12-29に、インデックス検索機能を外部サービス（file_index_service:8080）に分離しました。

## 変更内容

### 1. 全幅レイアウト
- `index.css` および `App.css` のスタイルを修正し、ブラウザの全幅を使用するようにしました。
- 右側の余計な余白を削除しました。

### 2. フィルタバーの改修
- **1行表示**: `flex-wrap: nowrap` と `overflow-x: auto` を適用し、横スクロール可能な1行レイアウトに変更しました。
- **ラベルの簡略化**: ボタンの幅を抑えるため「常用」「画像」「全」「ファイル」などの短縮名を採用しました。
- **表示崩れの修正**: `white-space: nowrap` と `flex-shrink: 0` を設定し、ズーム時にボタンが縦長に崩れる問題を解消しました。
- **フィルタ追加**: 「ファイルのみ」を表示するフィルタを追加しました。

### 3. パスコピー機能
- **アイコンの追加**: ファイル一覧および検索結果の各行に `Copy` アイコンボタンを追加しました。
- **機能**: アイコンをクリックすると、対象の絶対パスをクリップボードにコピーします。

### 4. 検索機能の改善
- **検索階層のデフォルト値**: `FileSearch.tsx` の階層（depth）の初期値を 0（無制限）から 1 に変更しました。
- **デバウンス時間の最適化**: 入力中のカクつきを防止するため、検索実行までの待機時間を300msから800msに延長しました。
- **IME入力対応**: 日本語などのIME入力中（変換中）は検索を実行せず、確定したタイミングで検索を実行するように改善しました。
- **インデックス検索の階層フィルタ**: 「Index」モードでの検索時に、階層指定（depth）が正しく適用されるようにバックエンドを修正しました（Index Allモードは対象外）。

### 5. 検索UI刷新 - 2行レイアウト化（2025-12-29）

検索コンポーネント（FileSearch）のUIをVSCode風の2行レイアウトに刷新しました。

#### 5.1 2行レイアウト構造

**1段目: キーワード検索**
- ファイル内容やファイル名を検索するメイン検索ボックス
- タイプフィルタボタン（全/F/D）
- 階層コントロール（+/-ボタン）

**2段目: ファイル名フィルタ**
- 検索結果をファイル名でさらに絞り込むフィルタボックス
- 正規表現トグルボタン（.* ボタン）

#### 5.2 ファイル名フィルタ機能

**キーワードモード（正規表現OFF）:**
- 単純なキーワード部分一致
- スペース区切りでOR検索
- 例: "md" → `.md`, `readme.md` などにマッチ
- 例: "md pdf txt" → `md`, `pdf`, `txt` のいずれかを含むファイルにマッチ

**正規表現モード（正規表現ON）:**
- 標準の正規表現パターンマッチング
- 例: `.*\.pdf$` → PDF ファイルのみ
- 例: `^test.*\.txt$` → `test`で始まるtxtファイル

#### 5.3 検索モードの変更

従来の `Live`, `Index`, `Index(ALL)` から以下の5モードに変更：

| モード | 説明 | 検索対象 |
|--------|------|----------|
| OFF | 検索無効（デフォルト） | なし |
| Live | リアルタイム検索 | initialPath以下 |
| Index(Left) | 左ペイン検索 | 左ペインのパス以下 |
| Index(Right) | 右ペイン検索 | 右ペインのパス以下 |
| Index(ALL) | 全インデックス検索 | 全監視パス |

**OFFモードの利点:**
- 誤操作による検索実行を防止
- 明示的なモード選択で意図的な検索を実現

#### 5.4 設定パネルの削除

インデックス検索機能が外部サービス（file_index_service:8080）に完全分離されたため、以下の設定UI要素を削除：

- インデックスサービスURL設定
- 監視パス管理（追加/削除）
- 除外パターン設定
- インデックス再構築ボタン

**削除コード量:** 418行（TypeScript: 188行、CSS: 230行）

**設定の管理方法:**
- すべての設定は外部サービス（http://localhost:5174）のUIで管理
- file_managerはモード選択と検索クエリのみを担当

#### 5.5 技術的改善

- **クライアントサイドフィルタリング**: ファイル名フィルタは検索結果をブラウザ側でフィルタリングするため高速
- **デバウンス処理**: 両方の入力ボックスで800msのデバウンスを実装
- **IME対応**: 日本語入力確定時に即座に検索実行
- **エラーハンドリング**: 正規表現エラー時は部分一致にフォールバック

## 影響範囲
- `frontend/src/components/FileList.tsx`, `.css`
- `frontend/src/components/FilterBar.tsx`, `.css`
- `frontend/src/components/FileSearch.tsx`, `.css`（大規模リファクタリング）
- `frontend/src/App.tsx`（leftPanePath/rightPanePath追加）
- `frontend/src/index.css`
- `frontend/src/App.css`

### 6. ツールバーのUI調整 (2025-01-04)

- **区切り線の追加**: 更新ボタンとテストボタンの間に縦線を追加し、機能グループを視覚的に分離しました。
- **ボタンデザイン**: テストフォルダボタンとゴミ箱ボタンの背景色（ピンク/水色）を廃止し、透明な背景に変更しました。
- **アイコン変更**: ゴミ箱ボタンのアイコンを `Trash2`（アウトライン形式）に統一しました。
